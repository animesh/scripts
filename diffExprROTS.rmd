```{r data}
inpF<-"F:/promec/Animesh/MK/proteinGroups.txt"
data<-read.table(inpF,header=T,sep="\t",row.names = 1)
summary(data)
```

```{r label}
inpL<-"F:/promec/Animesh/MK/Class.txt"
label<-read.table(inpL,header=T,row.names=1,sep="\t", colClasses=c(rep("factor",3)))
#colnames(label)=sub("\\-[0-9]+","",colnames(label))
#colnames(label)
summary(label)
```

```{r select}
yyt=as.matrix(data[,201:230])
yyt[is.na(yyt)]<-0
yyt<-log2(yyt)
yyt[is.infinite(yyt)]<-0
#yyt<-yyt[,-(which(colSums(yyt) == 0))] 
yyt<-yyt[-(which(rowSums(yyt) == 0)),] 
summary(yyt)
colnames(yyt)<-sub("LFQ.intensity.","",colnames(yyt))
colnames(yyt)
yyt<-yyt[,rownames(label)]
colnames(yyt)
#yyt[,9]=as.factor(yyt[,9])
```

```{r heatmap}
#install.packages('pheatmap')
library(pheatmap)
#?pheatmap
y<-as.matrix(yyt)
summary(y)
svgPHC<-pheatmap(y,scale="row",clustering_distance_rows = "correlation",clustering_distance_cols = "correlation",fontsize_row=6,annotation_col = label,show_rownames=F)
#ggsave(file=paste0(inpF,"corrcoefED.svg"), plot=svgPHC, width=6, height=6)
plot(svgPHC)
```

```{r scale}
#install.packages('quantable')
library(quantable)
y=robustscale(y)
y$data[is.na(y$data)]<-0
#names(y$data)=sub("X","",names(y$data))
pheatmap(y$data,scale="row",clustering_distance_rows = "manhattan",clustering_distance_cols = "manhattan",fontsize_row=6,annotation_col = label,show_rownames=F)
```

```{r PCA}
library(ggfortify)
#log.yyt=log(yyt[,1:8]+1)
#yyt.pca=prcomp(log.yyt,center=TRUE,scale.=TRUE) 
yyt.pca=prcomp(t(yyt),center=TRUE,scale.=TRUE) 
autoplot(yyt.pca,data=t(yyt),colour=as.numeric(label$Location))
autoplot(yyt.pca,data=t(yyt),colour=as.numeric(label$Treatment))
#biplot(yyt.pca)
```

```{r ROTS, echo = FALSE}
#install.packages("BiocManager")
#BiocManager::install("ROTS", version = "3.8")
#BiocManager::install("ROTS")
dataNormImpCom<-yyt
#dataNormImpCom[dataNormImpCom==0]=5
summary(dataNormImpCom)
library(ROTS)
input = dataNormImpCom
#colnames(dataNormImpCom)<-sub("X","",colnames(dataNormImpCom))
colnames(dataNormImpCom)
groups = label#$Code
groups
results = ROTS(data = dataNormImpCom, groups = as.numeric(groups$Location) , B = 250 , K = 1000 , seed = 42)
names(results) 
fdrThr<-0.01
uniP<-summary(results, fdr = fdrThr)
#?plot
#plot(results, fdr = fdrThr, type = "volcano")
plot(results, fdr = fdrThr, type = "heatmap")
```






```{r randomtree}
set.seed(42)
yy<-rbind(y$data,label$Treatment)
yyt<-t(yy)
summary(yyt)

yyt=as.data.frame(yyt)
colnames(yyt) <- gsub(";", "_", colnames(yyt))
colnames(yyt) <- gsub(":", "__", colnames(yyt))
colnames(yyt) <- gsub("-", "___", colnames(yyt))
summary(yyt)
ind=sample(2,nrow(yyt),replace=TRUE,prob=c(0.75,0.25))
yyt.training=yyt[ind==1,]
yyt.test=yyt[ind==2,]

library("rpart")
library("rpart.plot")
tree=rpart(data=yyt.training,V4500~.,method="class",control=rpart.control(minsplit=10,minbucket=5),parms=list(split="information"))
rpart.plot(tree,main="Classification tree for the yyt data (using 75% of data as training set)",extra=101)


library(randomForest)
set.seed(42)
#yyt=as.data.frame(yyt)
random_forest=randomForest(data=yyt.training,V4500~.,impurity='gini',ntree=200,replace=TRUE)
print(random_forest)

plot(random_forest)
legend("top",cex=0.8,legend=colnames(random_forest$err.rate),lty=c(1,2,3),col=c(1,2,3),horiz=T)

predictions=predict(random_forest,newdata=yyt.training,type="class")
actuals=yyt.training$V4500
table(actuals,predictions)

accuracy=sum(diag(confusion.matrix))/sum(confusion.matrix)
print(accuracy)

sort(importance(random_forest))
varImpPlot(random_forest)
#qplot(RCN1,GALNT2,data=yyt,colour=class,size=I(3))
```


```{r write}
#install.packages('dplyr')
#library(dplyr)
colnames(y$data)
yy<-rbind(y$data,label$Treatment)
yy<-t(yy)
write.csv(yy,paste0(inpF,".scaleWithclass.csv"))
```

